(self["webpackChunkel_table_virtual_scroll"]=self["webpackChunkel_table_virtual_scroll"]||[]).push([[677],{5677:function(t,e,i){"use strict";i.d(e,{Z:function(){return v}});var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"el-table-virtual-scroll",class:t.isExpanding?"is-expanding":""},[t._t("default")],2)},n=[],o=(i(1703),i(936)),s=i.n(o);function l(t){const e=window.getComputedStyle(t,null),i=["auto","scroll"];return i.includes(e["overflow"])||i.includes(e["overflow-y"])}function a(t){let e=t;while(e){if([window,document,document.documentElement].includes(e))return window;if(l(e))return e;e=e.parentNode}return e||window}function c(t){return t===window?window.pageYOffset:t.scrollTop}function h(t){return t===window?window.innerHeight:t.offsetHeight}function u(t,e){t===window?window.scroll(0,e):t.scrollTop=e}var f={name:"el-table-virtual-scroll",props:{data:{type:Array,required:!0},itemSize:{type:Number,default:60},scrollBox:{type:String},buffer:{type:Number,default:200},keyProp:{type:String,default:"id"},throttleTime:{type:Number,default:10},dynamic:{type:Boolean,default:!0}},provide(){return{virtualScroll:this}},data(){return{sizes:{},start:0,end:void 0,curRow:null,isExpanding:!1}},computed:{offsetMap({keyProp:t,itemSize:e,sizes:i,data:r}){if(!this.dynamic)return{};const n={};let o=0;for(let s=0;s<r.length;s++){const l=r[s][t];n[l]=o;const a=i[l],c="number"===typeof a?a:e;o+=c}return n}},methods:{initData(){if(this.renderData=[],this.top=void 0,this.bottom=void 0,this.start=0,this.end=void 0,this.elTable=this.$children[0],!this.elTable||"ElTable"!==this.elTable.$options.name)throw new Error("el-table-virtual-column 组件插槽内必须是el-table");this.scroller=this.getScroller(),setTimeout((()=>{this.handleScroll()}),100),this.onScroll=this.throttleTime?s()(this.handleScroll,this.throttleTime):this.handleScroll,this.scroller.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.onScroll),this.bindTableExpandEvent()},getScroller(){let t;if(this.scrollBox){if(t=document.querySelector(this.scrollBox),!t)throw new Error(` scrollBox prop: '${this.scrollBox}' is not a valid selector`);return l(t)||console.warn(`Warning! scrollBox prop: '${this.scrollBox}' is not a scroll element`),t}return this.elTable&&this.elTable.height?this.$el.querySelector(".el-table__body-wrapper"):a(this.$el)},updateSizes(){if(!this.dynamic)return;let t=this.$el.querySelectorAll(".el-table__body > tbody > .el-table__row"),e=!1;t[0]&&t[0].classList.contains("el-table__row--level-0")&&(e=!0,t=this.$el.querySelectorAll(".el-table__body > tbody > .el-table__row.el-table__row--level-0"));const i=this.$el.querySelectorAll(".el-table__row.hover-row");i.length>1&&Array.from(i).forEach((t=>{t.classList.remove("hover-row")})),Array.from(t).forEach(((t,i)=>{const r=this.renderData[i];if(!r)return;let n=t.offsetHeight;if(t.classList.contains("expanded")&&(n+=t.nextSibling.offsetHeight),e){let e=t.nextSibling;while(e&&"TR"===e.tagName&&!e.classList.contains("el-table__row--level-0"))n+=e.offsetHeight,e=e.nextSibling}const o=r[this.keyProp];this.sizes[o]!==n&&this.$set(this.sizes,o,n)}))},handleScroll(t=!0){this.updateSizes(),this.calcRenderData(),this.calcPosition(),t&&this.updatePosition(),this.$emit("change",this.renderData,this.start,this.end),this.setRowsExpanded()},getItemOffsetTop(t){if(!this.dynamic)return this.itemSize*t;const e=this.data[t];return e&&this.offsetMap[e[this.keyProp]]||0},getItemSize(t){if(t<=-1)return 0;const e=this.data[t];if(e){const t=e[this.keyProp];return this.sizes[t]||this.itemSize}return this.itemSize},calcRenderData(){const{scroller:t,data:e,buffer:i}=this,r=c(t)-i,n=c(t)+h(t)+i;let o,s;if(this.dynamic){let t=0,i=e.length-1,l=0;while(t<=i){l=Math.floor((t+i)/2);const e=this.getItemOffsetTop(l);if(e<r){const e=this.getItemOffsetTop(l+1);if(e>r)break;t=l+1}else i=l-1}o=l,s=e.length-1;for(let r=o+1;r<e.length;r++){const t=this.getItemOffsetTop(r);if(t>=n){s=r;break}}}else o=r<=0?0:Math.floor(r/this.itemSize),s=n<=0?0:Math.ceil(n/this.itemSize);o%2&&(o-=1),this.top=r,this.bottom=n,this.start=o,this.end=s,this.renderData=e.slice(o,s+1)},calcPosition(){const t=this.data.length-1,e=this.getItemOffsetTop(t)+this.getItemSize(t),i=this.getItemOffsetTop(this.start),r=[".el-table__body-wrapper",".el-table__fixed-right .el-table__fixed-body-wrapper",".el-table__fixed .el-table__fixed-body-wrapper"];r.forEach((t=>{const r=this.$el.querySelector(t);if(r){if(!r.wrapEl){const t=document.createElement("div"),e=document.createElement("div");t.appendChild(e),e.appendChild(r.children[0]),r.insertBefore(t,r.firstChild),r.wrapEl=t,r.innerEl=e}r.wrapEl&&(r.wrapEl.style.height=e+"px",r.innerEl.style.transform=`translateY(${i}px)`)}}))},updatePosition(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{this.timer&&clearTimeout(this.timer),this.handleScroll(!1)}),this.throttleTime+10)},update(){this.handleScroll()},scrollTo(t,e=!1){const i=this.data[t];i&&this.scroller&&(this.updateSizes(),this.calcRenderData(),this.$nextTick((()=>{const i=this.getItemOffsetTop(t);u(this.scroller,i),e||setTimeout((()=>{this.scrollTo(t,!0)}),50)})))},reset(){this.sizes={},this.scrollTo(0,!1)},checkAll(t){this.data.forEach((e=>this.$set(e,"$v_checked",t))),this.emitSelectionChange()},checkRow(t,e){this.$set(t,"$v_checked",e),this.emitSelectionChange()},emitSelectionChange(){const t=this.data.filter((t=>t.$v_checked));this.$emit("selection-change",t)},clearSelection(){this.checkAll(!1)},toggleRowSelection(t,e){const i="boolean"===typeof e?e:!t.$v_checked;this.checkRow(t,i)},bindTableExpandEvent(){this.isExpandType&&this.elTable.$on("expand-change",((t,e)=>{this.$set(t,"$v_expanded",e.includes(t))}))},setRowsExpanded(){this.isExpandType&&this.$nextTick((()=>{const t=this.renderData.filter((t=>t.$v_expanded));0!==t.length&&(t.forEach((t=>{this.elTable.toggleRowExpansion(t,!0)})),this.isExpanding=!0,setTimeout((()=>{this.isExpanding=!1}),10))}))},toggleRowsExpansion(t,e){t.forEach((t=>{this.$set(t,"$v_expanded",e)})),this.setRowsExpanded()},updateData(t){this.$emit("update:data",t)},setCurrentRow(t){this.curRow=t}},watch:{data(){this.update()}},created(){this.$nextTick((()=>{this.initData()}))},beforeDestroy(){this.scroller&&(this.scroller.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onScroll))}},d=f,p=i(3736),m=(0,p.Z)(d,r,n,!1,null,"a1cf5cf2",null),v=m.exports},5841:function(t,e,i){var r=i(195),n=r.Symbol;t.exports=n},4812:function(t,e,i){var r=i(5841),n=i(7039),o=i(4492),s="[object Null]",l="[object Undefined]",a=r?r.toStringTag:void 0;function c(t){return null==t?void 0===t?l:s:a&&a in Object(t)?n(t):o(t)}t.exports=c},2437:function(t,e,i){var r=i(5788),n=/^\s+/;function o(t){return t?t.slice(0,r(t)+1).replace(n,""):t}t.exports=o},3412:function(t,e,i){var r="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g;t.exports=r},7039:function(t,e,i){var r=i(5841),n=Object.prototype,o=n.hasOwnProperty,s=n.toString,l=r?r.toStringTag:void 0;function a(t){var e=o.call(t,l),i=t[l];try{t[l]=void 0;var r=!0}catch(a){}var n=s.call(t);return r&&(e?t[l]=i:delete t[l]),n}t.exports=a},4492:function(t){var e=Object.prototype,i=e.toString;function r(t){return i.call(t)}t.exports=r},195:function(t,e,i){var r=i(3412),n="object"==typeof self&&self&&self.Object===Object&&self,o=r||n||Function("return this")();t.exports=o},5788:function(t){var e=/\s/;function i(t){var i=t.length;while(i--&&e.test(t.charAt(i)));return i}t.exports=i},7360:function(t,e,i){i(1703);var r=i(1442),n=i(2804),o=i(4622),s="Expected a function",l=Math.max,a=Math.min;function c(t,e,i){var c,h,u,f,d,p,m=0,v=!1,b=!1,g=!0;if("function"!=typeof t)throw new TypeError(s);function w(e){var i=c,r=h;return c=h=void 0,m=e,f=t.apply(r,i),f}function y(t){return m=t,d=setTimeout(T,e),v?w(t):f}function x(t){var i=t-p,r=t-m,n=e-i;return b?a(n,u-r):n}function S(t){var i=t-p,r=t-m;return void 0===p||i>=e||i<0||b&&r>=u}function T(){var t=n();if(S(t))return _(t);d=setTimeout(T,x(t))}function _(t){return d=void 0,g&&c?w(t):(c=h=void 0,f)}function E(){void 0!==d&&clearTimeout(d),m=0,c=p=h=d=void 0}function $(){return void 0===d?f:_(n())}function k(){var t=n(),i=S(t);if(c=arguments,h=this,p=t,i){if(void 0===d)return y(p);if(b)return clearTimeout(d),d=setTimeout(T,e),w(p)}return void 0===d&&(d=setTimeout(T,e)),f}return e=o(e)||0,r(i)&&(v=!!i.leading,b="maxWait"in i,u=b?l(o(i.maxWait)||0,e):u,g="trailing"in i?!!i.trailing:g),k.cancel=E,k.flush=$,k}t.exports=c},1442:function(t){function e(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}t.exports=e},3862:function(t){function e(t){return null!=t&&"object"==typeof t}t.exports=e},2771:function(t,e,i){var r=i(4812),n=i(3862),o="[object Symbol]";function s(t){return"symbol"==typeof t||n(t)&&r(t)==o}t.exports=s},2804:function(t,e,i){var r=i(195),n=function(){return r.Date.now()};t.exports=n},936:function(t,e,i){i(1703);var r=i(7360),n=i(1442),o="Expected a function";function s(t,e,i){var s=!0,l=!0;if("function"!=typeof t)throw new TypeError(o);return n(i)&&(s="leading"in i?!!i.leading:s,l="trailing"in i?!!i.trailing:l),r(t,e,{leading:s,maxWait:e,trailing:l})}t.exports=s},4622:function(t,e,i){var r=i(2437),n=i(1442),o=i(2771),s=NaN,l=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,h=parseInt;function u(t){if("number"==typeof t)return t;if(o(t))return s;if(n(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=n(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=r(t);var i=a.test(t);return i||c.test(t)?h(t.slice(2),i?2:8):l.test(t)?s:+t}t.exports=u}}]);
//# sourceMappingURL=677.d8ac462d.js.map