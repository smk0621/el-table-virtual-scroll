(self["webpackChunkel_table_virtual_scroll"]=self["webpackChunkel_table_virtual_scroll"]||[]).push([[716],{802:function(e,t,i){var n=i(1990),l=n.Symbol;e.exports=l},6251:function(e,t,i){var n=i(802),l=i(3845),o=i(7760),s="[object Null]",r="[object Undefined]",a=n?n.toStringTag:void 0;function c(e){return null==e?void 0===e?r:s:a&&a in Object(e)?l(e):o(e)}e.exports=c},3349:function(e,t,i){var n=i(3676),l=/^\s+/;function o(e){return e?e.slice(0,n(e)+1).replace(l,""):e}e.exports=o},8371:function(e,t,i){var n="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g;e.exports=n},3845:function(e,t,i){var n=i(802),l=Object.prototype,o=l.hasOwnProperty,s=l.toString,r=n?n.toStringTag:void 0;function a(e){var t=o.call(e,r),i=e[r];try{e[r]=void 0;var n=!0}catch(a){}var l=s.call(e);return n&&(t?e[r]=i:delete e[r]),l}e.exports=a},7760:function(e){var t=Object.prototype,i=t.toString;function n(e){return i.call(e)}e.exports=n},1990:function(e,t,i){var n=i(8371),l="object"==typeof self&&self&&self.Object===Object&&self,o=n||l||Function("return this")();e.exports=o},3676:function(e){var t=/\s/;function i(e){var i=e.length;while(i--&&t.test(e.charAt(i)));return i}e.exports=i},8530:function(e,t,i){i(1703);var n=i(359),l=i(9263),o=i(7044),s="Expected a function",r=Math.max,a=Math.min;function c(e,t,i){var c,h,d,u,p,f,v=0,m=!1,b=!1,g=!0;if("function"!=typeof e)throw new TypeError(s);function w(t){var i=c,n=h;return c=h=void 0,v=t,u=e.apply(n,i),u}function x(e){return v=e,p=setTimeout($,t),m?w(e):u}function y(e){var i=e-f,n=e-v,l=t-i;return b?a(l,d-n):l}function _(e){var i=e-f,n=e-v;return void 0===f||i>=t||i<0||b&&n>=d}function $(){var e=l();if(_(e))return S(e);p=setTimeout($,y(e))}function S(e){return p=void 0,g&&c?w(e):(c=h=void 0,u)}function T(){void 0!==p&&clearTimeout(p),v=0,c=f=h=p=void 0}function k(){return void 0===p?u:S(l())}function C(){var e=l(),i=_(e);if(c=arguments,h=this,f=e,i){if(void 0===p)return x(f);if(b)return clearTimeout(p),p=setTimeout($,t),w(f)}return void 0===p&&(p=setTimeout($,t)),u}return t=o(t)||0,n(i)&&(m=!!i.leading,b="maxWait"in i,d=b?r(o(i.maxWait)||0,t):d,g="trailing"in i?!!i.trailing:g),C.cancel=T,C.flush=k,C}e.exports=c},359:function(e){function t(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}e.exports=t},6841:function(e){function t(e){return null!=e&&"object"==typeof e}e.exports=t},6619:function(e,t,i){var n=i(6251),l=i(6841),o="[object Symbol]";function s(e){return"symbol"==typeof e||l(e)&&n(e)==o}e.exports=s},9263:function(e,t,i){var n=i(1990),l=function(){return n.Date.now()};e.exports=l},1953:function(e,t,i){i(1703);var n=i(8530),l=i(359),o="Expected a function";function s(e,t,i){var s=!0,r=!0;if("function"!=typeof e)throw new TypeError(o);return l(i)&&(s="leading"in i?!!i.leading:s,r="trailing"in i?!!i.trailing:r),n(e,t,{leading:s,maxWait:t,trailing:r})}e.exports=s},7044:function(e,t,i){var n=i(3349),l=i(359),o=i(6619),s=NaN,r=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,h=parseInt;function d(e){if("number"==typeof e)return e;if(o(e))return s;if(l(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=l(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=n(e);var i=a.test(e);return i||c.test(e)?h(e.slice(2),i?2:8):r.test(e)?s:+e}e.exports=d},7716:function(e,t,i){"use strict";i.d(t,{Fg:function(){return T},ZP:function(){return k}});var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"el-table-virtual-scroll",class:[e.isExpanding?"is-expanding":"",e.isHideAppend?"hide-append":""]},[e._t("default")],2)},l=[],o=(i(1703),i(1953)),s=i.n(o);function r(e){const t=window.getComputedStyle(e,null),i=["auto","scroll"];return i.includes(t.overflow)||i.includes(t["overflow-y"])}function a(e){let t=e;while(t){if([window,document,document.documentElement].includes(t))return window;if(r(t))return t;t=t.parentNode}return t||window}function c(e){return e===window?window.pageYOffset:e.scrollTop}function h(e){return e===window?window.innerHeight:e.offsetHeight}function d(e,t){e===window?window.scroll(0,t):e.scrollTop=t}const u=[".el-table__body-wrapper",".el-table__fixed-right .el-table__fixed-body-wrapper",".el-table__fixed .el-table__fixed-body-wrapper"];let p=0;var f={name:"el-table-virtual-scroll",props:{data:{type:Array,required:!0},itemSize:{type:Number,default:60},scrollBox:{type:String},buffer:{type:Number,default:200},keyProp:{type:String,default:"id"},throttleTime:{type:Number,default:10},dynamic:{type:Boolean,default:!0},virtualized:{type:Boolean,default:!0}},provide(){return{virtualScroll:this}},data(){return{sizes:{},start:0,end:void 0,curRow:null,isExpanding:!1,columnVms:[],isHideAppend:!1}},computed:{offsetMap({keyProp:e,itemSize:t,sizes:i,data:n}){if(!this.dynamic)return{};const l={};let o=0;for(let s=0;s<n.length;s++){const r=n[s][e];l[r]=o;const a=i[r],c="number"===typeof a?a:t;o+=c}return l}},methods:{initData(){if(this.renderData=[],this.top=void 0,this.bottom=void 0,this.start=0,this.end=void 0,this.isInnerScroll=!1,this.toTop=0,this.elTable=this.$children[0],!this.elTable||"ElTable"!==this.elTable.$options.name)throw new Error("el-table-virtual-column 组件插槽内必须是el-table");this.scroller=this.getScroller(),this.setToTop(),setTimeout((()=>{this.handleScroll()}),100),this.onScroll=this.throttleTime?s()(this.handleScroll,this.throttleTime):this.handleScroll,this.scroller.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.onScroll),this.bindTableExpandEvent()},getScroller(){let e;if(this.scrollBox){if(e=document.querySelector(this.scrollBox),!e)throw new Error(` scrollBox prop: '${this.scrollBox}' is not a valid selector`);return r(e)||console.warn(`Warning! scrollBox prop: '${this.scrollBox}' is not a scroll element`),e}return this.elTable&&this.elTable.height?(this.isInnerScroll=!0,this.$el.querySelector(".el-table__body-wrapper")):a(this.$el)},setToTop(){this.toTop=this.isInnerScroll?0:this.$el.getBoundingClientRect().top-this.scroller.getBoundingClientRect().top},handleScroll(e=!0){this.virtualized&&(this.removeHoverRows(),this.updateSizes(),this.calcRenderData(),this.calcPosition(),e&&this.updatePosition(),this.$emit("change",this.renderData,this.start,this.end),this.setRowsExpanded())},removeHoverRows(){const e=this.$el.querySelectorAll(".el-table__row.hover-row");e.length>1&&Array.from(e).forEach((e=>{e.classList.remove("hover-row")}))},updateSizes(){if(!this.dynamic)return;let e=this.$el.querySelectorAll(".el-table__body > tbody > .el-table__row"),t=!1;e[0]&&e[0].classList.contains("el-table__row--level-0")&&(t=!0,e=this.$el.querySelectorAll(".el-table__body > tbody > .el-table__row.el-table__row--level-0")),Array.from(e).forEach(((e,i)=>{const n=this.renderData[i];if(!n)return;let l=e.offsetHeight;if(e.classList.contains("expanded")&&(l+=e.nextSibling.offsetHeight),t){let t=e.nextSibling;while(t&&"TR"===t.tagName&&!t.classList.contains("el-table__row--level-0"))l+=t.offsetHeight,t=t.nextSibling}const o=n[this.keyProp];this.sizes[o]!==l&&this.$set(this.sizes,o,l)}))},getItemOffsetTop(e){if(!this.dynamic)return this.itemSize*e;const t=this.data[e];return t&&this.offsetMap[t[this.keyProp]]||0},getItemSize(e){if(e<=-1)return 0;const t=this.data[e];if(t){const e=t[this.keyProp];return this.sizes[e]||this.itemSize}return this.itemSize},calcRenderData(){const{scroller:e,data:t,buffer:i}=this,n=c(e)-i-this.toTop,l=c(e)+h(e)+i-this.toTop;let o,s;if(this.dynamic){let e=0,i=t.length-1,r=0;while(e<=i){r=Math.floor((e+i)/2);const t=this.getItemOffsetTop(r);if(t<n){const t=this.getItemOffsetTop(r+1);if(t>n)break;e=r+1}else i=r-1}o=r,s=t.length-1;for(let n=o+1;n<t.length;n++){const e=this.getItemOffsetTop(n);if(e>=l){s=n;break}}}else o=n<=0?0:Math.floor(n/this.itemSize),s=l<=0?0:Math.ceil(l/this.itemSize);o%2&&(o-=1),this.top=n,this.bottom=l,this.start=o,this.end=s,this.renderData=t.slice(o,s+1)},calcPosition(){const e=this.data.length-1,t=this.getItemOffsetTop(e)+this.getItemSize(e),i=this.getItemOffsetTop(this.start);u.forEach((e=>{const n=this.$el.querySelector(e);if(n){if(!n.wrapEl){const e=document.createElement("div"),t=document.createElement("div");e.appendChild(t),t.appendChild(n.children[0]),n.insertBefore(e,n.firstChild),n.wrapEl=e,n.innerEl=t}n.wrapEl&&(n.wrapEl.style.height=t+"px",n.innerEl.style.transform=`translateY(${i}px)`)}}))},updatePosition(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{this.timer&&clearTimeout(this.timer),this.handleScroll(!1)}),this.throttleTime+10)},renderAllData(){this.renderData=this.data,this.$emit("change",this.data,0,this.data.length-1),this.$nextTick((()=>{u.forEach((e=>{const t=this.$el.querySelector(e);t&&t.wrapEl&&(t.wrapEl.style.height="auto",t.innerEl.style.transform="translateY(0px)")}))}))},update(){this.setToTop(),this.handleScroll()},scrollTo(e,t=!1){const i=this.data[e];i&&this.scroller&&(this.updateSizes(),this.calcRenderData(),this.$nextTick((()=>{const i=this.getItemOffsetTop(e);d(this.scroller,i),t||setTimeout((()=>{this.scrollTo(e,!0)}),50)})))},reset(){this.sizes={},this.scrollTo(0,!1)},addColumn(e){this.columnVms.push(e)},removeColumn(e){this.columnVms=this.columnVms.filter((t=>t!==e))},checkAll(e){this.data.forEach((t=>this.checkRow(t,e,!1))),this.emitSelectionChange(),!1===e&&(p=0)},checkRow(e,t,i=!0){e.$v_checked!==t&&(this.$set(e,"$v_checked",t),this.$set(e,"$v_checkedOrder",t?p++:void 0),i&&this.emitSelectionChange())},emitSelectionChange(){const e=this.data.filter((e=>e.$v_checked)).sort(((e,t)=>e.$v_checkedOrder-t.$v_checkedOrder));this.$emit("selection-change",e)},clearSelection(){this.checkAll(!1),this.columnVms.forEach((e=>e.syncCheckStatus()))},toggleRowSelection(e,t){const i="boolean"===typeof t?t:!e.$v_checked;this.checkRow(e,i),this.columnVms.forEach((e=>e.syncCheckStatus()))},bindTableExpandEvent(){this.isExpandType&&this.elTable.$on("expand-change",((e,t)=>{this.$set(e,"$v_expanded",t.includes(e))}))},setRowsExpanded(){this.isExpandType&&this.$nextTick((()=>{const e=this.renderData.filter((e=>e.$v_expanded));0!==e.length&&(e.forEach((e=>{this.elTable.toggleRowExpansion(e,!0)})),this.isExpanding=!0,setTimeout((()=>{this.isExpanding=!1}),10))}))},toggleRowExpansion(e,t){const i="boolean"===typeof t;this.$set(e,"$v_expanded",i?t:!e.$v_expanded),this.renderData.includes(e)&&this.elTable.toggleRowExpansion(e,t)},setCurrentRow(e){this.curRow=e,this.$emit("current-change",e)},updateData(e){this.$emit("update:data",e)},doUpdate(){this.hasDoUpdate||this.scroller&&(this.isHideAppend=!0,this.update(),this.hasDoUpdate=!0,this.$nextTick((()=>{this.hasDoUpdate=!1,this.isHideAppend=!1})))}},watch:{data(){this.virtualized?this.doUpdate():this.renderAllData()},virtualized:{immediate:!0,handler(e){e?this.doUpdate():this.renderAllData()}}},created(){this.$nextTick((()=>{this.initData()}))},beforeDestroy(){this.scroller&&(this.scroller.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onScroll))}},v=f,m=i(1001),b=(0,m.Z)(v,n,l,!1,null,"7737c170",null),g=b.exports,w=function(){var e=this,t=e._self._c;return t("el-table-column",e._g(e._b({attrs:{"class-name":e.isTree?"el-table__row--level":""},scopedSlots:e._u([{key:"header",fn:function(i){return[e._t("header",(function(){return["v-selection"===i.column.type?t("el-checkbox",{attrs:{indeterminate:e.isCheckedImn},on:{change:e.onCheckAllRows},model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}}):[e._v(" "+e._s(i.column.label)+" ")]]}),null,i)]}},{key:"default",fn:function(i){return[i.column&&"v-tree"===i.column.type?[t("span",{staticClass:"el-table__indent",style:{paddingLeft:(i.row.$level-1)*e.indent+"px"}}),!1!==i.row.$v_hasChildren?t("div",{staticClass:"el-table__expand-icon",class:i.row.$v_expanded?"el-table__expand-icon--expanded":"",on:{click:function(t){return e.onTreeNodeExpand(i.row)}}},[i.row.$v_loading?t("i",{staticClass:"el-icon-loading"}):t("i",{staticClass:"el-icon-arrow-right"})]):t("span",{staticClass:"el-table__placeholder"})]:e._e(),e._t("default",(function(){return["v-selection"===i.column.type?t("el-checkbox",{attrs:{value:i.row.$v_checked},on:{change:function(t){return e.onCheckRow(i.row,!i.row.$v_checked)}}}):e._e(),"v-radio"===i.column.type?t("el-radio",{attrs:{label:!0,value:e.virtualScroll.curRow===i.row},on:{change:function(t){return e.onRadioChange(i.row)}}},[t("span")]):"v-index"===i.column.type?t("span",[e._v(" "+e._s(e.getIndex(i))+" ")]):[e._v(" "+e._s(i.row[i.column.property])+" ")]]}),null,i)]}}],null,!0)},"el-table-column",e.$attrs,!1),e.$listeners))},x=[],y=i(5114),_={name:"el-table-virtual-column",components:{ElTableColumn:y.TableColumn,ElCheckbox:y.Checkbox,ElRadio:y.Radio},inject:["virtualScroll"],props:{load:{type:Function},indent:{type:Number,default:16}},data(){return{isCheckedAll:!1,isCheckedImn:!1,isTree:!1}},methods:{onCheckAllRows(e){e=!!this.isCheckedImn||e,this.virtualScroll.checkAll(e),this.isCheckedAll=e,this.isCheckedImn=!1},onCheckRow(e,t){this.virtualScroll.checkRow(e,t),this.syncCheckStatus()},syncCheckStatus(){const e=this.virtualScroll.data,t=e.filter((e=>!0===e.$v_checked)).length;0===t?(this.isCheckedAll=!1,this.isCheckedImn=!1):t===e.length?(this.isCheckedAll=!0,this.isCheckedImn=!1):(this.isCheckedAll=!1,this.isCheckedImn=!0)},onRadioChange(e){this.virtualScroll.setCurrentRow(e)},getIndex(e){const t=this.virtualScroll.start+e.$index;return"function"===typeof this.$attrs.index?this.$attrs.index(t):t+1},onTreeNodeExpand(e){this.$set(e,"$v_expanded",!e.$v_expanded),e.$v_expanded?this.loadChildNodes(e):this.hideChildNodes(e)},loadChildNodes(e){if(e.$v_loaded){const t=this.virtualScroll.data,i=t.findIndex((t=>t===e));i>-1&&this.virtualScroll.updateData([...t.slice(0,i+1),...e.$v_hideNodes,...t.slice(i+1)])}else this.$set(e,"$v_loading",!0),this.load&&this.load(e,t.bind(this));function t(t){Array.isArray(!t)&&(t=[]),this.$set(e,"$v_loading",!1),this.$set(e,"$v_loaded",!0),this.$set(e,"$v_hasChildren",!!t.length),t.forEach((t=>{t.$level="number"===typeof e.$level?e.$level+1:2}));const i=this.virtualScroll.data,n=i.findIndex((t=>t===e));n>-1&&this.virtualScroll.updateData([...i.slice(0,n+1),...t,...i.slice(n+1)])}},hideChildNodes(e){const t=this.virtualScroll.data,i=t.findIndex((t=>t===e));if(-1===i)return;const n=[];for(let o=i+1;o<t.length;o++){const i=t[o];if((i.$level||1)<=(e.$level||1))break;n.push(i)}this.$set(e,"$v_hideNodes",n);const l=t.filter((e=>!n.includes(e)));this.virtualScroll.updateData(l),this.virtualScroll.update()}},beforeCreate(){const{type:e}=this.$attrs;["index","selection","radio","tree"].includes(e)&&(this.$attrs.type="v-"+e)},created(){this.virtualScroll.addColumn(this);const{type:e}=this.$attrs;"expand"===e?this.virtualScroll.isExpandType=!0:"v-tree"===e&&(this.isTree=!0)},beforeDestroy(){this.virtualScroll.removeColumn(this)}},$=_,S=(0,m.Z)($,w,x,!1,null,"f03a52aa",null),T=S.exports,k=g}}]);
//# sourceMappingURL=716.0517d3c3.js.map